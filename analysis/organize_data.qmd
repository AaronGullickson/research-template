---
title: "Organize Data Notebook"
---

```{r}
#label: timestamp-start

timestamp()
```

```{r}
#| label: setup
#| include: false
library(here)
source(here("utils","check_packages.R"))
source(here("utils","functions.R"))
```

This quarto doc is used to organize the data.

# Download Data

```{r}
#| label: download-data

# This script checks if the data version on the remote repo matches the local
# and if not it downloads the required data and then updates the local version.

# get latest data version from repo
repo_version <- read_yaml(here("data", "data_raw", "data_version.yml"))$version

# get local data version
local_version_path <- here("data", "data_raw", "data_version_local.yml")
if (file_exists(local_version_path)) {
  local_version <- read_yaml(local_version_path)$version
} else {
  local_version <- "none"
}

if(local_version != repo_version) {
  
  # deauthorize google drive to avoid interactive prompts
  drive_deauth()

  # download data locally
  drive_download(as_id("1pCoTrcy87-R4ISZl1qhBczNRUsWZxY6R"), 
                 path = here("data", "data_raw", "acs.dat.gz"))
  
  # update local to repo version
  write_yaml(list(version = repo_version), 
             here("data", "data_raw", "data_version_local.yml"))
}
```


```{r}
#label: timestamp-end

timestamp()
```